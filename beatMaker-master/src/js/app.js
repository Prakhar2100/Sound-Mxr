class Dkit{constructor(){this.currentKick="../public/assets/sound/kick-classic.wav",this.pads=document.querySelectorAll("div.pad"),this.playBtn=document.querySelector("button.play"),this.kickAudio=document.querySelector("audio.kick-sound"),this.currentSnare="../public/assets/sound/snare-acounstic01.wav",this.snareAudio=document.querySelector("audio.snare-sound"),this.currentHihat="../public/assets/sound/hihat-acounstic01.wav",this.bpm=150,this.index=0,this.isPlaying=null,this.hithatAudio=document.querySelector("audio.hihat-sound"),this.bpmSlider=document.querySelector("input.bpm-slider"),this.muteBtns=document.querySelectorAll("button.mute"),this.selects=document.querySelectorAll("select")}repeat(){const e=document.querySelectorAll(`div.b${t}`);let t=this.index%8;e.forEach(e=>{e.classList.contains("active")?(e.style.animation="playTrack 350ms alternate cubic-bezier(0.48, 0.88, 0.43, 0.86)",e.classList.contains("kick-pad")&&(this.kickAudio.currentTime=0,this.kickAudio.play()),e.classList.contains("snare-pad")&&(this.snareAudio.currentTime=0,this.snareAudio.play()),e.classList.contains("hihat-pad")&&(this.hithatAudio.currentTime=0,this.hithatAudio.play())):e.style.animation="shines 500ms reverse linear forwards"}),this.index++}activePad(e){this.storeSequence(e),e.target.classList.toggle("active")}changeSound(e){const t=e.target.value,s=e.target.name;switch(this.storeChangeSound(e),s){case"kick-select":this.kickAudio.src=t;break;case"snare-select":this.snareAudio.src=t;break;case"hihat-select":this.hithatAudio.src=t}}changeBpm(e){const t=document.querySelector(".bpm-value");localStorage.setItem("bpm",e.target.value),this.bpm=e.target.value,t.innerText=e.target.value}updateBtn(){this.isPlaying?(this.playBtn.classList.remove("active"),this.playBtn.innerText="Play"):(this.playBtn.classList.add("active"),this.playBtn.innerText="Stop")}start(){const e=60/this.bpm*1e3;this.isPlaying?(clearInterval(this.isPlaying),this.isPlaying=null):this.isPlaying=setInterval(()=>{this.repeat()},e)}mute(e){const t=e.target.getAttribute("data-track");let s;switch(e.target.classList.toggle("active")?(e.target.firstElementChild.innerText="volume_off",s=0):(e.target.firstElementChild.innerText="volume_up",s=1),this.storeMute(e),t){case"0":this.kickAudio.volume=s;break;case"1":this.snareAudio.volume=s;break;case"2":this.hithatAudio.volume=s}}storeMute(e){let t;t=e.target.classList.contains("active")?1:0,localStorage.setItem("mute"+e.target.getAttribute("data-track"),t)}updateInterval(){clearInterval(this.isPlaying);const e=document.querySelector("button.play");this.isPlaying=null,e.classList.contains("active")&&this.start()}storeSequence(e){const t=e.target.parentNode.getAttribute("data-index"),s=[...e.target.parentNode.children].indexOf(e.target),a=JSON.parse(localStorage.getItem(`sequence${t}`))||[];-1!=a.indexOf(s)?a.splice(a.indexOf(s),1):a.push(s),localStorage.setItem(`sequence${t}`,JSON.stringify(a))}storeChangeSound(e){localStorage.setItem(e.target.name,e.target.value)}}class Ddown{constructor(){this.helpButton=document.querySelector("span.help-info")}activeDropDown(){this.nextElementSibling.classList.toggle("active")}}const Drums=new Dkit;Drums.playBtn.addEventListener("click",()=>{Drums.start(),Drums.updateBtn()}),Drums.pads.forEach(e=>{e.addEventListener("click",e=>{Drums.activePad(e)}),e.addEventListener("animationend",function(){this.style.animation=""})}),Drums.muteBtns.forEach(e=>{e.addEventListener("click",function(e){Drums.mute(e)})}),Drums.selects.forEach(e=>{e.addEventListener("change",function(){Drums.changeSound(event)})}),Drums.bpmSlider.addEventListener("input",function(e){Drums.changeBpm(e)}),Drums.bpmSlider.addEventListener("change",function(e){Drums.updateInterval(e)});const Drop=new Ddown;Drop.helpButton.addEventListener("mouseenter",Drop.activeDropDown),Drop.helpButton.addEventListener("mouseleave",Drop.activeDropDown);class ChangeTheme{constructor(){this.themeButton=document.querySelector("button.btn-theme")}active(){this.themeButton.classList.toggle("active")?(this.themeButton.firstElementChild.innerText="brightness_7",this.setColor()):(this.themeButton.firstElementChild.innerText="brightness_5",this.setColor())}setColor(){this.themeButton.classList.contains("active")?(document.body.classList.add("dark-theme"),localStorage.setItem("darkTheme",1)):(document.body.classList.remove("dark-theme"),localStorage.setItem("darkTheme",0))}}const Themechanger=new ChangeTheme;Themechanger.themeButton.addEventListener("click",()=>{Themechanger.active()});class LastState extends Dkit{constructor(){super(),this.darkTheme=parseInt(localStorage.getItem("darkTheme")),this.getBpm=localStorage.getItem("bpm"),this.selecteds={"snare-select":localStorage.getItem("snare-select"),"hihat-select":localStorage.getItem("hihat-select"),"kick-select":localStorage.getItem("kick-select")},this.mutes=[parseInt(localStorage.getItem("mute0")),parseInt(localStorage.getItem("mute1")),parseInt(localStorage.getItem("mute2"))],this.sequences=(()=>({0:JSON.parse(localStorage.getItem("sequence0")),1:JSON.parse(localStorage.getItem("sequence1")),2:JSON.parse(localStorage.getItem("sequence2"))})),this.padBox=document.querySelectorAll("div.pad-box"),this.btnReset=document.querySelector("button.btn-reset")}setState(){this.darkTheme&&Themechanger.themeButton.dispatchEvent(new Event("click")),this.muteBtns.forEach((e,t)=>{this.mutes[t]&&this.muteBtns[t].dispatchEvent(new Event("click"))}),this.getBpm&&(this.bpmSlider.value=this.getBpm,this.bpmSlider.dispatchEvent(new Event("input"))),this.selects.forEach(e=>{this.selecteds[e.name]&&(e.value=this.selecteds[e.name],e.dispatchEvent(new Event("change")))});const e=this.sequences();for(let t in e){let s=this.padBox[t].children;for(let a in s){let i=[...s].indexOf(s[a]);e[t]&&-1!=e[t].indexOf(i)&&s[a].classList.add("active")}}}resetPadState(){const e=this.sequences();for(let t in e){let s=this.padBox[t].children;for(let a in s){let i=[...s].indexOf(s[a]);e[t]&&-1!=e[t].indexOf(i)&&s[a].classList.remove("active")}}localStorage.setItem("sequence0","[]"),localStorage.setItem("sequence1","[]"),localStorage.setItem("sequence2","[]")}}const lastState=new LastState;document.addEventListener("DOMContentLoaded",()=>{lastState.setState()}),lastState.btnReset.addEventListener("click",e=>{lastState.resetPadState(e),e.target.firstChild.style.transform="rotate(-360deg)",e.target.firstChild.addEventListener("transitionend",e=>{e.target.style.transform="rotate(0deg)"})});